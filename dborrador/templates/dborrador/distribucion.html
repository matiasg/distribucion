{% extends "dborrador/base.html" %}

{% load static %}

{% block subtitulo %}
    Distribución para {{ anno }}, cuatrimestre {{ cuatrimestre }},
    tipo de docentes {{ tipo }}, intento {{ intento }}
{% endblock subtitulo %}

{% block cuerpo %}
<link rel="stylesheet" type="text/css" href="{% static 'materias/horarios.css' %}">


<p>
    <div class="subseccion"><div id="titulo">Ver otra distribución</div>
        <form action="{% url 'dborrador:distribucion' anno cuatrimestre tipo intento %}" method="post">
            {% csrf_token %}
            Ver intento: <input type="number" name="nuevo_intento" value={{ intento }}>
            <input type="submit" name="cambiar" value="ver nuevo intento">
            <input type="hidden" name="anno" value="{{ anno }}">
            <input type="hidden" name="cuatrimestre" value="{{ cuatrimestre }}">
            <input type="hidden" name="tipo" value="{{ tipo }}">
    </div>

<p>
    <div class="subseccion"><div id="titulo">Fijar docentes para un nuevo intento</div>
        Intento al que fijarlos: <input type="number" name="proximo_intento" value={{ nuevo_intento }}>
        <input type="submit" name="fijar" value="fijar docentes">
    </div>

<p>
    <div class="subseccion"><div id="titulo">Problemas encontrados</div>
        {% if problemas.cargas_no_distribuidas %}
        <div id="problema">Cargas docentes sin distribución</div>
        <ul>
            {% for carga in problemas.cargas_no_distribuidas %}
            <li>{{ carga.docente }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if problemas.necesidades_no_cubiertas %}
        <div id="problema">Turnos con necesidades insatisfechas</div>
        <ul>
            {% for turno, necesidad in problemas.necesidades_no_cubiertas %}
            <li>{{ turno }} necesita <b>{{ necesidad }}</b> docente(s)</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
{% for tipo, lista in materias %}

<div class="seccion">{{ tipo }}</div>

    {% for materia, turnos in lista %}

    {% if turnos %}
    <table class="contentbold" border="1" cellspacing="0" cellpadding="5" frame="hsides">
        <thead><div class="nombremateria">{{ materia.nombre.upper }}</div></thead>
        <tbody>
        {% for turno in turnos %}
            <tr>

            <td class="fondo{{ turno.tipo }}">{{ turno.horarios_info.tipoynumero }}</td>
            <td>{{ turno.horarios_info.diayhora }}</td>
            <td>{% for asignacion, en_distribucion in turno.cargas_asignadas %}
                {% if en_distribucion %}
                <input type="checkbox" name="asignacion_fijada" value="{{ asignacion.id }}">
                {% endif %}
                {{ asignacion.carga.docente.nombre }}
                {% endfor %}
            </td>
                
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% endfor %}

{% endfor %}
</form>

{% if no_distribuidos %}
    <h3>Docentes no distribuidos</h3>
    <ol>
    {% for docente in no_distribuidos %}
    <li>{{ docente }}</li>
    {% endfor %}
    </ol>
{% endif %}
{% endblock cuerpo %}
