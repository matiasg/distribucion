<!DOCTYPE html>
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'materias/horarios.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'dborrador/dborrador.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'dborrador/indice.css' %}">

{% comment %}<link rel="stylesheet" type="text/css" href="{% static 'dborrador/jquery-ui.min.css' %}">{% endcomment %}
{% comment %}<script src="{% static 'dborrador/jquery-1.12.4.min.js' %}"></script>{% endcomment %}
{% comment %}<script src="{% static 'dborrador/jquery-ui.min.js' %}"></script>{% endcomment %}

  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script src="{% static 'dborrador/scripts.js' %}"></script>
<script>
  $(function() {
    var selector_intento = $("#selector_intento").spinner();
    var selector_intento_manual = $("#selector_intento_manual").slider();
    selector_intento_manual.slider(
      {min: 0, max: {{ max_intento_manual }}, value: {{ intento_manual }} });

    selector_intento.spinner({min: 0, max: {{ max_intento_algoritmo }}});
    selector_intento.spinner("value", {{ intento_algoritmo }} );
    selector_intento.on("spin", function(event, ui) {
      var url = "{% url 'dborrador:espiar_distribucion' anno cuatrimestre 31415926535 intento_manual %}";
      $(location).attr('href', url.replace('31415926535', ui.value));
    });

    selector_intento_manual.on("slide", function(event, ui) {
      var url = "{% url 'dborrador:espiar_distribucion' anno cuatrimestre intento_algoritmo 31415926535 %}";
      $(location).attr('href', url.replace('31415926535', ui.value));
    });
  })
</script>

<head>
    <title>Zona de borrador de distribución</title>
</head>

<div class="partido izquierda">
{% block indice %}
    <h2>Qué hacer</h2>
    {% if anno %}

    <ul class="sin_puntos">
    <form action="{% url 'dborrador:distribucion' anno cuatrimestre intento_algoritmo intento_manual %}" method="post">
    {% csrf_token %}
        <li>Año: {{ anno }} <input type="hidden" name="anno" value="{{ anno }}"></li>
        <li>Cuatrimestre: {{ cuatrimestre }} <input type="hidden" name="cuatrimestre" value="{{ cuatrimestre }}"></li>
        <li>Intento:
            <input id="selector_intento" name="intento_algoritmo">
            <div id="selector_intento_manual" name="intento_manual"></div>
        <input type="submit" name="distribucion" value="mirar">
    </form>

    <div class="base_opciones">
        <li>
          <form action="{% url 'dborrador:preparar' anno cuatrimestre %}" method="post">
            {% csrf_token %}
            <button name="paso_siguiente" value="copiar encuestas">Copiar encuestas</button>
          </form>
        </li>
        <li>
          <button id="distribuir">Correr el algoritmo</button>

          <div id="preguntas_distribucion_algoritmo" title="Correr el algoritmo">
            <form action="{% url 'dborrador:seleccion_tipo_distribuir' anno cuatrimestre intento_algoritmo intento_manual %}" method="post">
              {% csrf_token %}

              {% if intento < max_intento %}
              <div class="subseccion"><div id="titulo">Cuidado</div></div>
              El intento en el que vas a distribuir, {{ intento_algoritmo }}, no es el último.
              Vas a borrar lo que hayas hecho después de este intento.
              {% endif %}

              <p> Elegí el tipo de docente
                <select name="tipo">
                  {% for t in tipos %}
                  <option value="{{ t.name }}">{{ t.value }}</option>
                  {% endfor %}
                </select>
              </p>
              <p>
                <input type="submit" name="hacer_distribucion" value="Hacer la distribución">
              </p>
            </form>
          </div>
        </li>

      </ul>
    </div>


    {% else %}

    <form action="{% url 'dborrador:empezar' %}" method="post">
        {% csrf_token %}
        <ul style="list-style-type:none;">
            <li> Año: 
                <select name="anno">
                    {% for a in annos %}
                    <option value="{{ a }}">{{ a }}</option>
                    {% endfor %}
                </select>
            </li>

            <li> Cuatrimestre: 
                <select name="cuatrimestre">
                    {% for c in cuatrimestres %}
                    <option value="{{ c.name }}">{{ c.value }}</option>
                    {% endfor %}
                </select>
            </li>
            <input type="submit" name="distribuir" value="Comenzar a distribuir">
        </ul>
    </form>

    {% endif %}

{% endblock indice %}
</div>


<div class="partido derecha">
<h3>{% block subtitulo %}{% endblock subtitulo %}</h3>
{% block cuerpo %}{% endblock cuerpo %}
</div>
